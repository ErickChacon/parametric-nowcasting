---
title: "Prepare SARI data"
prerequisites:
    - data/cleaned/clean_data_srag_epiweek_delay_table_PR.csv
targets:
    - data/processed/sari_cum_2009_06_14_to_11_22.rds
---



<div id="load-packages-scripts-and-data" class="section level2">
<h2>Load packages, scripts and data</h2>
<pre class="r"><code>path_proj &lt;- here::here()
path_src &lt;- file.path(path_proj, &quot;src&quot;)
path_data &lt;- file.path(path_proj, &quot;data&quot;)
path_cleaned &lt;- file.path(path_data, &quot;cleaned&quot;)
path_processed &lt;- file.path(path_data, &quot;processed&quot;)

library(dplyr)</code></pre>
<pre><code>#&gt; 
#&gt; Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>#&gt; The following objects are masked from &#39;package:stats&#39;:
#&gt; 
#&gt;     filter, lag</code></pre>
<pre><code>#&gt; The following objects are masked from &#39;package:base&#39;:
#&gt; 
#&gt;     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(aweek)
library(tidyr)

source(file.path(path_src, &quot;process-data.R&quot;))

sari &lt;- path_cleaned |&gt;
    file.path(&quot;clean_data_srag_epiweek_delay_table_PR.csv&quot;) |&gt;
    readr::read_csv()</code></pre>
<pre><code>#&gt; Rows: 10373 Columns: 32</code></pre>
<pre><code>#&gt; ── Column specification ───────────────────────────────────────────────────────────────────────────────────────────────
#&gt; Delimiter: &quot;,&quot;
#&gt; dbl (32): epiweek, epiyear, regionalsaude, Notifications, d0, d1, d2, d3, d4, d5, d6, d7, d8, d9...
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div id="process-data" class="section level2">
<h2>Process data</h2>
<ul>
<li>Standardise variable names,</li>
<li>create the date of the week and year,</li>
<li>filter a region of interest <span class="math inline">\(41002\)</span> and</li>
<li>filter dates of interest from <code>2009-06-14</code> to <code>2009-11-22</code>.</li>
</ul>
<pre class="r"><code>date_period &lt;- as.Date(c(&quot;2009-06-14&quot;, &quot;2009-11-22&quot;))
sari_41002 &lt;- sari |&gt;
    rename_with(tolower) |&gt;
    mutate(date = get_date(week = epiweek, year = epiyear, start = 7)) |&gt;
    filter(regionalsaude == 41002, date &gt;= date_period[1], date &lt;= date_period[2]) |&gt;
    select(- c(&quot;epiweek&quot;, &quot;epiyear&quot;, &quot;regionalsaude&quot;)) |&gt;
    rename_with(function(x) gsub(&quot;d&quot;, &quot;delay&quot;, x), d0:d26) |&gt;
    relocate(notifications_within_26w, notifications, .after = last_col())</code></pre>
<p>Compute the cumulative number of cases.</p>
<pre class="r"><code>sari_41002[, 1:27] &lt;- t(apply(as.matrix(sari_41002[, 1:27]), 1, cumsum))
sari_41002</code></pre>
<pre><code>#&gt; # A tibble: 24 × 30
#&gt;    delay0 delay1 delay2 delay3 delay4 delay5 delay6 delay7 delay8 delay9 delay10 delay11 delay12
#&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1      0      3      3      3      3      3      3      6      7      7       7       8       8
#&gt;  2      2      4      5      7      7      9     12     15     15     16      16      16      16
#&gt;  3      2     13     17     21     22     30     35     39     39     41      41      41      41
#&gt;  4     14     16     17     18     19     22     23     25     26     26      27      27      27
#&gt;  5      2     11     11     25     39     47     53     56     58     58      58      58      59
#&gt;  6      2     18     91    154    179    198    204    207    207    207     209     209     209
#&gt;  7     32    329    463    519    550    559    567    572    575    578     579     581     586
#&gt;  8    272    563    749    932   1025   1061   1080   1088   1094   1102    1109    1140    1167
#&gt;  9    183    549    767    893    974   1050   1071   1091   1112   1119    1132    1146    1152
#&gt; 10    145    417    510    573    643    667    681    699    738    748     757     761     766
#&gt; # ℹ 14 more rows
#&gt; # ℹ 17 more variables: delay13 &lt;dbl&gt;, delay14 &lt;dbl&gt;, delay15 &lt;dbl&gt;, delay16 &lt;dbl&gt;, delay17 &lt;dbl&gt;,
#&gt; #   delay18 &lt;dbl&gt;, delay19 &lt;dbl&gt;, delay20 &lt;dbl&gt;, delay21 &lt;dbl&gt;, delay22 &lt;dbl&gt;, delay23 &lt;dbl&gt;,
#&gt; #   delay24 &lt;dbl&gt;, delay25 &lt;dbl&gt;, delay26 &lt;dbl&gt;, date &lt;date&gt;, notifications_within_26w &lt;dbl&gt;,
#&gt; #   notifications &lt;dbl&gt;</code></pre>
</div>
<div id="save-processed-data" class="section level2">
<h2>Save processed data</h2>
<pre class="r"><code>saveRDS(sari_41002, file.path(path_processed, &quot;sari_cum_2009_06_14_to_11_22.rds&quot;))</code></pre>
</div>
<div id="time-to-execute-the-task" class="section level2">
<h2>Time to execute the task</h2>
<p>Only useful when executed with <code>Rscript</code>.</p>
<pre class="r"><code>proc.time()</code></pre>
<pre><code>#&gt;    user  system elapsed 
#&gt;   0.700   0.335   0.673</code></pre>
</div>
